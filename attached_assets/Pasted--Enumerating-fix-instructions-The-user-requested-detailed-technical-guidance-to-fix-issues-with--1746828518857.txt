**Enumerating fix instructions**

The user requested detailed technical guidance to fix issues with their Repl.it project. The main points to address include:

* Adjusting margin CSS to reduce top, left, and right margins, while increasing the bottom margin.
* Ensuring the page size and margin values are correctly set in the PDF generator.
* Correcting the footer logo position to be absolutely aligned bottom-right with an offset 20-30px.
* Organizing the ‘Skills & Languages’ section properly with bold headers and clear separation between skills and languages.
  This should cover all the noted problems.

**Message to Repl.it agent**

Please make the following adjustments:

* Move the "PROFESSIONAL EXPERIENCE" header out of the skills row and add a horizontal gray rule underneath.
* Lighten the horizontal rule under "Education."
* Eliminate duplicate text in bullet points (e.g., remove repetition of metrics).
* Fix duplicated verbs in bullet points by removing them.
* Ensure all three experience roles are present in the estimation resume (add "civil group" and "Somague").
* Verify the pagination to ensure no breaks within sections, and address any remaining margin issues.
* Adjust CSS for margins, footer, and proper header placements.


Thought for 22 seconds


Below is a **step‑by‑step punch‑list for the next sprint**.  It is written so you can copy‑paste it straight into the Replit chat; every item references the exact file(s) to touch and the specific change required, so there’s no ambiguity.

---

### 1  |  Fix the page margins & footer logo

* **templates/resume.html**

  1. Inside the `<style>` block add / edit an `@page` rule:

     ```css
     @page {
       size: A4;
       margin: 40px 40px 90px 40px;   /* L,R,T = 40px  Δ  Bottom = 90px for footer */
     }
     ```
  2. Wrap the existing body content in a container `<div class="page-body">` and add:

     ```css
     .page-body{padding:0;margin:0;position:relative;}
     ```
  3. Move the Near branding markup (the “Presented by” span + `<img>`) **out of the normal flow**:

     ```html
     <footer class="branding-footer">
       <span><strong>Presented by</strong></span>
       <img src="cid:near-logo" alt="Near logo"/>
     </footer>
     ```
  4. Add footer styles:

     ```css
     .branding-footer{
       position:absolute;
       bottom:30px;
       right:30px;
       display:flex;
       gap:6px;
       font-family:'Inter','Helvetica',sans-serif;
       font-size:10px;
       align-items:center;
     }
     .branding-footer img{width:55px;height:auto;}
     ```

  This restores equal top/left/right margins, increases bottom margin for the footer, and pins the logo 30 px from the bottom‑right corner on every page.

---

### 2  |  Break “Professional Experience” into its own section

* **templates/resume.html**

  1. **Delete** the inline text `PROFESSIONAL EXPERIENCE` that is currently appended to the Skills paragraph.
  2. Insert the normal section header exactly like the other sections:

     ```html
     <h2 class="section-header">PROFESSIONAL EXPERIENCE</h2>
     <hr class="section-rule"/>
     ```
* **parser.ts → htmlRenderer()**
  When you inject data for Skills & Languages, close the paragraph after the skills list, then create a **separate block** for Languages and finally emit the Experience header.  Pseudocode:

  ```ts
  html += `<p><strong>Skills:</strong> ${skillList}</p>`;
  html += `<p><strong>Languages:</strong> ${languageList}</p>`;
  html += `<h2 class="section-header">PROFESSIONAL EXPERIENCE</h2><hr class="section-rule"/>`;
  ```

---

### 3  |  Repair “Skills” / “Languages” rendering

* **templates/resume.html** – keep one section title, **SKILLS & LANGUAGES**.
* **openai.ts → transformResume()** already consolidates to two categories (“Skills” & “Languages”); verify `htmlRenderer()` prints **both lines** exactly as above so we no longer see `Languages -->` orphaned.

---

### 4  |  Lighten the horizontal rules

* **templates/resume.html**

  ```css
  .section-rule{
      border:none;
      border-top:1px solid #d9d9d9;   /* lighter grey */
      margin:3px 0 12px;
  }
  ```

  Apply the same class under **Education** and **Additional Experience** so visual weight is consistent.

---

### 5  |  Remove bullet‑level duplication & metrics echo

* **openai.ts → removeBulletRepetition()**
  Extend logic:

  * If the bullet `text` already contains a metric (e.g. “reduced costs by 18 %”), drop identical phrases from the `metrics[]` array.
  * After deduplication, if `metrics[]` is empty, keep the bullet but leave `metrics` as `[]`.

* **limitBulletPoints()** – we still allow up to 7 bullets; verify the scoring function isn’t duplicating similar sentences when trimming.

---

### 6  |  Make sure *all three* roles appear in detailed resumes

* **openai.ts → validateAndEnhanceResume()**
  When `detailedFormat === true`, assert `resume.experience.length >= 3`.
  If not, call a helper `rehydrateMissingRoles(originalText)` that re‑parses the raw resume for any dropped jobs and inserts them before HTML generation.

---

### 7  |  Currency & unit cleaning (quick patch)

* **utils/currency.ts** – After converting foreign values to USD, strip trailing currency codes to avoid `$50M USD BRL`.

  ```ts
  return formatted.replace(/\s+(USD|AUD|BRL|EUR)$/, '');
  ```

---

### 8  |  CSS tidy for bullets & spacing

* **templates/resume.html**

  ```css
  ul{margin:0 0 8px 18px;padding:0;}
  li{margin:0 0 4px;font-size:11px;line-height:1.25;}
  ```

  Keeps text tight and readable inside the new narrower margins.

---

### 9  |  Regression checklist (add to `test_resume_preview.html`)

1. Top/left/right margins ≈ 40 px; bottom ≈ 90 px.
2. Footer always \~30 px from bottom edge.
3. Section order: Summary – Skills & Languages – Professional Experience – Education – Additional Experience.
4. Horizontal rules light grey (#d9d9d9).
5. “Professional Experience” header is **not** inline with skills.
6. Languages line rendering verified.
7. No duplicated metrics or lines.
8. All three jobs present, ≤ 7 bullets each.
9. PDF still prints on two pages max with no orphan section headers.

Run `npm run generate --detailed sample.docx` and open the resulting PDF & `test_resume_preview.html` before closing the ticket.

---

### 10  |  Files you need to modify in this PR

* `templates/resume.html`
* `parser.ts` (html generation section)
* `utils/currency.ts`
* `openai.ts` (`removeBulletRepetition`, `validateAndEnhanceResume`, `limitBulletPoints`)
* (Optional) any helper you add under `utils/` for missing‑role hydration.

Make these updates, regenerate a sample detailed PDF, and drop it here for final QA.
